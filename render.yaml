services:
  - type: web
    name: predicta-api
    env: python
    region: frankfurt
    plan: free
    
    repo: https://github.com/devcem09-cmd/predicta-api
    branch: main
    
    # Build command - Install dependencies and train model
    buildCommand: |
      echo "ğŸ“¦ Installing dependencies..."
      pip install --upgrade pip
      pip install -r requirements.txt
      echo "âœ… Dependencies installed"
      
      echo "ğŸ¯ Training model during build phase..."
      mkdir -p models data
      if [ -f "app/weighted_trainer.py" ]; then
        python app/weighted_trainer.py || echo "âš ï¸ Training failed, will use existing model"
      fi
      echo "âœ… Build complete"
    
    # Start command - Use uvicorn directly
    startCommand: |
      echo "ğŸš€ Starting Predicta API..."
      echo "ğŸ“Š Model status check..."
      if [ -f "models/weighted_model.pkl" ]; then
        echo "âœ… Model found"
      else
        echo "âš ï¸ Model not found - API will run in limited mode"
      fi
      echo "ğŸŒ Starting uvicorn server..."
      uvicorn main_weighted:app --host 0.0.0.0 --port $PORT --log-level info
    
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: PORT
        sync: false  # Render otomatik atar
      - key: LOG_LEVEL
        value: info
      - key: WORKERS
        value: 1  # Free plan iÃ§in tek worker
    
    # Health check - Mevcut endpoint'e gÃ¶re ayarlayÄ±n
    healthCheckPath: /
    
    # Auto deploy
    autoDeploy: true
    
    # Disk ayarlarÄ± (model iÃ§in)
    disk:
      name: predicta-data
      mountPath: /opt/render/project/src/models
      sizeGB: 0.512
